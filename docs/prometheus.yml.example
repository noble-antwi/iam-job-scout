# Prometheus Configuration for IAM Job Scout Monitoring
# 
# This file should be placed on your Prometheus server at:
# /etc/prometheus/prometheus.yml
#
# After updating, reload Prometheus with:
#   curl -X POST http://localhost:9090/-/reload
# OR
#   sudo systemctl reload prometheus

global:
  # How frequently to scrape targets
  scrape_interval: 15s
  
  # How long until a scrape request times out
  scrape_timeout: 10s
  
  # How frequently to evaluate rules
  evaluation_interval: 15s
  
  # Attach these labels to all time series and alerts
  external_labels:
    monitor: 'iam-job-scout-monitor'
    environment: 'production'

# Load rules once and periodically evaluate them
rule_files:
  - "/etc/prometheus/rules/*.yml"

# Alertmanager configuration (optional)
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            # Uncomment if you have Alertmanager running
            # - 'localhost:9093'

# Scrape configurations
scrape_configs:
  # Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: 'prometheus-server'

  # IAM Job Scout Application
  - job_name: 'iam-job-scout'
    
    # Override global scrape interval for this job
    scrape_interval: 15s
    scrape_timeout: 10s
    
    # Path where metrics are exposed
    metrics_path: '/metrics'
    
    # Scheme: http or https
    scheme: http
    
    # Static targets
    static_configs:
      - targets:
          # REPLACE THIS with your Docker HOST IP (recommended)
          # 
          # RECOMMENDED: Use Docker Host IP (stable, doesn't change)
          #   Get it with: hostname -I | awk '{print $1}'
          #   Example: '192.168.1.100:5000'
          #
          # NOT RECOMMENDED: Container IP (changes on restart!)
          #   Get it with: docker inspect iam-job-scout-web-1 | grep IPAddress
          #   Example: '172.18.0.2:5000'
          #
          # Examples:
          #   - '192.168.1.100:5000'       # Host machine IP (BEST)
          #   - 'localhost:5000'           # If Prometheus on same host
          #   - '172.17.0.2:5000'          # Container IP (will break on restart!)
          - 'YOUR_APP_HOST_IP:5000'
        
        # Additional labels for this target
        labels:
          app: 'iam-job-scout'
          environment: 'production'
          instance: 'web-1'
          service: 'job-scout-api'
    
    # Optional: Basic auth if you protect your metrics endpoint
    # basic_auth:
    #   username: 'prometheus'
    #   password: 'your-password'
    
    # Optional: Bearer token authentication
    # authorization:
    #   type: Bearer
    #   credentials: 'your-token'

  # Node Exporter (for system metrics) - Optional but Recommended
  # Install with: apt-get install prometheus-node-exporter
  - job_name: 'node-exporter'
    static_configs:
      - targets:
          # REPLACE with your host IP
          - 'YOUR_APP_HOST_IP:9100'
        labels:
          instance: 'app-server'
          role: 'application'

# Optional: Remote write configuration for long-term storage
# remote_write:
#   - url: "http://remote-storage:9201/write"

# Optional: Remote read configuration
# remote_read:
#   - url: "http://remote-storage:9201/read"
